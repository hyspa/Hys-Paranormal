<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>URBEX HYSP V25.6</title>
    
    <link rel="apple-touch-icon" href="https://r.jina.ai/i/44079825b4ec471286c8d769493f0b24">
    <link rel="icon" href="https://r.jina.ai/i/44079825b4ec471286c8d769493f0b24">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --neon: #00ff41; --bg: #050505; --ariane: #00d4ff; --danger: #ff3e3e; }
        body, html { height: 100dvh; margin: 0; padding: 0; background: var(--bg); color: #eee; font-family: 'Courier New', monospace; overflow: hidden; }
        #main-container { display: flex; flex-direction: column; height: 100dvh; }
        
        header { 
            background: #000; border-bottom: 2px solid var(--neon); padding: 12px; 
            display: flex; justify-content: space-between; align-items: center; z-index: 2000;
        }

        #side-menu { 
            position: fixed; top: 0; left: -280px; width: 260px; height: 100%; 
            background: rgba(10,10,10,0.98); border-right: 1px solid var(--neon); 
            transition: 0.4s; z-index: 3000; padding-top: 20px; 
        }

        .menu-header { text-align: center; padding: 15px; border-bottom: 1px solid var(--neon); margin-bottom: 10px; }
        .menu-header img { width: 80px; border-radius: 15px; border: 1px solid var(--neon); }

        .menu-item { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; font-size: 0.75rem; }
        #map { flex-grow: 1; width: 100%; background: #000; }
        
        .status-bar { background: #000; padding: 6px 15px; font-size: 0.6rem; display: flex; justify-content: space-between; border-top: 1px solid #333; color: var(--neon); }
        
        .action-bar { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; 
            padding: 10px; background: #000; border-top: 2px solid #222; 
            padding-bottom: calc(10px + env(safe-area-inset-bottom)); 
        }
        
        .act-btn { background: #111; border: 1px solid #333; color: #fff; padding: 12px 0; border-radius: 4px; font-size: 0.6rem; cursor: pointer; text-align: center; font-weight: bold; }
        .btn-active { border-color: var(--ariane); color: var(--ariane); box-shadow: 0 0 10px var(--ariane); }
        
        #panicPage { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; color: #000; z-index: 9999; padding: 25px; font-family: serif; }
    </style>
</head>
<body>

<div id="side-menu">
    <div class="menu-header">
        <img src="https://r.jina.ai/i/44079825b4ec471286c8d769493f0b24" alt="HYSP LOGO">
        <div style="color:var(--neon); margin-top:10px; font-size:0.8rem;">URBEX GHOST HYSP</div>
    </div>
    <div class="menu-item" onclick="map.setView([41.4, 2.1], 12); toggleMenu()">üìç FOCUS : CATALOGNE</div>
    <div class="menu-item" onclick="map.setView([42.88, -8.54], 12); toggleMenu()">üìç FOCUS : GALICE</div>
    <div class="menu-item" onclick="exportData()">üíæ BACKUP JSON</div>
    <div class="menu-item" onclick="toggleMenu()" style="margin-top:20px; text-align:center; color:#666;">[ FERMER ]</div>
</div>

<div id="panicPage" onclick="this.style.display='none'">
    <h1>Rapport Logistique HYSP 2026</h1>
    <p>√âtude des structures industrielles en zone urbaine dense. Maintenance p√©riodique...</p>
</div>

<div id="main-container">
    <header>
        <div onclick="toggleMenu()" style="cursor:pointer; font-size: 1.5rem; color: var(--neon);">‚ò∞</div>
        <div style="font-weight: bold; font-size: 0.8rem; letter-spacing: 2px;">HYSP_OS_V25.6</div>
        <button onclick="document.getElementById('panicPage').style.display='block'" style="background:none; border:1px solid var(--danger); color:var(--danger); padding:4px 8px; border-radius:4px; font-size:0.6rem;">PANIC</button>
    </header>

    <div id="map"></div>

    <div class="status-bar">
        <span id="track-status">GPS IDLE</span>
        <span id="pts-count">0 SPOTS</span>
    </div>

    <div class="action-bar">
        <button class="act-btn" onclick="addSpot()">üìç +SPOT</button>
        <button id="btn-track" class="act-btn" onclick="toggleTracking()">üë£ TRACER</button>
        <button class="act-btn" onclick="updateGPS()">üõ∞Ô∏è RE-SYNC</button>
        <button class="act-btn" onclick="toggleMenu()">‚öôÔ∏è MENU</button>
    </div>
</div>

<script>
    let map, pathLine, userMarker, markers = [];
    let pathCoords = [], isTracking = false;

    // BASE DE DONN√âES SPOTS R√âELS
    const database = [
        { n: "üè• Hospital del T√≥rax", lat: 41.5925, lon: 2.0155 },
        { n: "üè∞ Torre Salvana", lat: 41.3655, lon: 2.0205 },
        { n: "üèòÔ∏è La Mussara", lat: 41.2505, lon: 1.0560 },
        { n: "üè• Sanatorio de Cesuras", lat: 43.1670, lon: -8.2040 },
        { n: "üèòÔ∏è Marmellar", lat: 41.3601, lon: 1.5147 },
        { n: "üè¢ Preventori Savinosa", lat: 41.1215, lon: 1.2825 },
        { n: "üè≠ Conserverie Mass√≥", lat: 42.2615, lon: -8.7915 }
    ];

    let spots = JSON.parse(localStorage.getItem('urbex_spots')) || database;

    function init() {
        map = L.map('map', { zoomControl: false, attributionControl: false }).setView([41.38, 2.17], 11);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        pathLine = L.polyline([], {color: 'var(--ariane)', weight: 4, dashArray: '5, 10', opacity: 0.8}).addTo(map);
        loadSpots();
        updateGPS();
        setInterval(autoTrack, 5000);
    }

    function toggleMenu() {
        const m = document.getElementById('side-menu');
        m.style.left = (m.style.left === '0px') ? '-280px' : '0px';
    }

    function loadSpots() {
        markers.forEach(m => map.removeLayer(m));
        markers = [];
        spots.forEach(s => {
            const m = L.circleMarker([s.lat, s.lon], {radius: 5, color: 'var(--neon)', fillColor: '#000', fillOpacity: 0.8, weight: 2}).addTo(map).bindPopup(s.n);
            markers.push(m);
        });
        document.getElementById('pts-count').innerText = `${spots.length} SPOTS`;
    }

    function addSpot() {
        navigator.geolocation.getCurrentPosition(pos => {
            const name = prompt("NOM DU SPOT :");
            if(name) {
                const newSpot = { n: name, lat: pos.coords.latitude, lon: pos.coords.longitude };
                spots.push(newSpot);
                localStorage.setItem('urbex_spots', JSON.stringify(spots));
                loadSpots();
            }
        }, null, {enableHighAccuracy: true});
    }

    function toggleTracking() {
        isTracking = !isTracking;
        document.getElementById('btn-track').classList.toggle('btn-active');
        document.getElementById('track-status').innerText = isTracking ? "TRACKING ACTIVE" : "TRACKING PAUSED";
    }

    function autoTrack() {
        if (!isTracking) return;
        navigator.geolocation.getCurrentPosition(pos => {
            const current = [pos.coords.latitude, pos.coords.longitude];
            if (pathCoords.length === 0 || map.distance(current, pathCoords[pathCoords.length - 1]) > 5) {
                pathCoords.push(current);
                pathLine.setLatLngs(pathCoords);
            }
        }, null, {enableHighAccuracy: true});
    }

    function updateGPS() {
        navigator.geolocation.getCurrentPosition(pos => {
            const current = [pos.coords.latitude, pos.coords.longitude];
            if (!userMarker) {
                userMarker = L.circleMarker(current, { radius: 10, color: '#fff', fillColor: 'var(--ariane)', fillOpacity: 1 }).addTo(map);
            } else { userMarker.setLatLng(current); }
            document.getElementById('track-status').innerText = "GPS OK";
        }, null, {enableHighAccuracy: true});
    }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(spots));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "hysp_backup.json");
        downloadAnchorNode.click();
    }

    window.onload = init;
</script>
</body>
</html>
