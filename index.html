<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HYSP URBEX</title>
    
    <link rel="icon" type="image/png" href="https://i.ibb.co/XfR0mR9/hysp-icon.png">
    <link rel="apple-touch-icon" href="https://i.ibb.co/XfR0mR9/hysp-icon.png">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --neon: #00ff41; --bg: #050505; --ariane: #00d4ff; --danger: #ff3e3e; }
        body, html { height: 100%; margin: 0; padding: 0; background: var(--bg); color: #eee; font-family: sans-serif; overflow: hidden; }
        #main-container { display: flex; flex-direction: column; height: 100vh; height: 100dvh; }
        header { background: #000; border-bottom: 2px solid var(--neon); padding: 10px; display: flex; justify-content: space-between; align-items: center; z-index: 2000; }
        #map { flex-grow: 1; width: 100%; background: #111; }
        #side-menu { position: fixed; top: 0; left: -280px; width: 260px; height: 100%; background: #0a0a0a; border-right: 1px solid var(--neon); transition: 0.3s; z-index: 3000; padding: 20px; box-sizing: border-box; }
        .menu-item { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; color: var(--neon); font-size: 0.9rem; }
        .action-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; padding: 10px; background: #000; border-top: 1px solid #333; }
        .act-btn { background: #111; border: 1px solid #444; color: #fff; padding: 10px 0; border-radius: 4px; font-size: 0.6rem; text-align: center; }
        .status-bar { background: #000; padding: 5px 10px; font-size: 0.6rem; display: flex; justify-content: space-between; color: var(--neon); }
    </style>
</head>
<body>

<div id="side-menu">
    <h2 style="color:var(--neon)">HYSP_OS</h2>
    <div class="menu-item" onclick="map.setView([41.38, 2.17], 12); toggleMenu()">üìç BARCELONE</div>
    <div class="menu-item" onclick="map.setView([43.16, -8.20], 12); toggleMenu()">üìç GALICE</div>
    <div class="menu-item" onclick="resetData()" style="color:var(--danger)">‚ö†Ô∏è RESET SPOTS</div>
    <div class="menu-item" onclick="toggleMenu()" style="color:#666; margin-top:20px;">[ FERMER ]</div>
</div>

<div id="main-container">
    <header>
        <div onclick="toggleMenu()" style="font-size: 1.5rem; color: var(--neon); cursor:pointer;">‚ò∞</div>
        <div style="font-size: 0.8rem; font-weight: bold;">HYSP V25.9</div>
        <div style="width: 30px;"></div>
    </header>

    <div id="map"></div>

    <div class="status-bar">
        <span id="gps-status">GPS WAIT...</span>
        <span id="count">0 SPOTS</span>
    </div>

    <div class="action-bar">
        <button class="act-btn" onclick="addSpot()">+SPOT</button>
        <button class="act-btn" onclick="updateGPS()">SYNC</button>
        <button class="act-btn" onclick="toggleMenu()">MENU</button>
        <button class="act-btn" onclick="location.reload()">RELOAD</button>
    </div>
</div>

<script>
    let map, markers = [];
    const spotsList = [
        { n: "Hospital del T√≥rax", lat: 41.5925, lon: 2.0155 },
        { n: "Torre Salvana", lat: 41.3655, lon: 2.0205 },
        { n: "La Mussara", lat: 41.2505, lon: 1.0560 },
        { n: "Sanatorio de Cesuras", lat: 43.1670, lon: -8.2040 },
        { n: "Marmellar", lat: 41.3601, lon: 1.5147 },
        { n: "Savinosa Tarragona", lat: 41.1215, lon: 1.2825 },
        { n: "Conserverie Mass√≥", lat: 42.2615, lon: -8.7915 },
        { n: "Casino Arrabassada", lat: 41.4285, lon: 2.1245 },
        { n: "Usine AEG", lat: 41.5644, lon: 2.0288 }
    ];

    function init() {
        map = L.map('map', { zoomControl: false }).setView([41.38, 2.17], 10);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        loadMarkers();
        updateGPS();
        setTimeout(() => map.invalidateSize(), 500);
    }

    function toggleMenu() {
        const m = document.getElementById('side-menu');
        m.style.left = (m.style.left === '0px') ? '-280px' : '0px';
    }

    function loadMarkers() {
        markers.forEach(m => map.removeLayer(m));
        markers = [];
        let data = JSON.parse(localStorage.getItem('hysp_spots')) || spotsList;
        data.forEach(s => {
            let m = L.circleMarker([s.lat, s.lon], {radius: 7, color: 'var(--neon)', fillOpacity: 0.8}).addTo(map).bindPopup(s.n);
            markers.push(m);
        });
        document.getElementById('count').innerText = data.length + " SPOTS";
    }

    function addSpot() {
        navigator.geolocation.getCurrentPosition(p => {
            let name = prompt("Nom du spot ?");
            if(name) {
                let data = JSON.parse(localStorage.getItem('hysp_spots')) || [...spotsList];
                data.push({n: name, lat: p.coords.latitude, lon: p.coords.longitude});
                localStorage.setItem('hysp_spots', JSON.stringify(data));
                loadMarkers();
            }
        });
    }

    function updateGPS() {
        navigator.geolocation.getCurrentPosition(p => {
            let pos = [p.coords.latitude, p.coords.longitude];
            L.circleMarker(pos, {radius: 10, color: '#fff', fillColor: '#00d4ff', fillOpacity: 1}).addTo(map);
            map.setView(pos, 14);
            document.getElementById('gps-status').innerText = "GPS OK";
        }, () => { document.getElementById('gps-status').innerText = "GPS OFF"; });
    }

    function resetData() {
        localStorage.removeItem('hysp_spots');
        location.reload();
    }

    window.onload = init;
</script>
</body>
</html>
